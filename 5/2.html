<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BsketBall</title>
  <meta name="description" content="Responsive table that loads data from Google Apps Script and reveals rows/columns over time.">
  <style>
    :root{
      
      --bg:#051027; --card:#051027;
      --muted:#9fb0d6; --accent:#6b8cff; --text:#ffffff;
    }
    html,body{margin:0;background:linear-gradient(180deg,var(--bg),#051027);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;}
    .wrap{max-width:100%;margin:0 auto;}
    .card{background:var(--card);border-radius:12px;padding:12px;}
    h3{margin:0 0 8px 0;font-size:16px}
    .controls{display:flex;gap:8px;margin-bottom:8px;align-items:center}
    .btn{background:transparent;color:var(--text);border:1px solid rgba(255,255,255,0.06);padding:6px 8px;border-radius:8px;font-size:13px;cursor:pointer}
    .btn.warn{border-color:rgba(255,80,80,0.18);color:#ffd6d6}

    /* Table base (desktop) */
    .table-wrap{overflow-x:auto}
    table{width:100%;border-collapse:collapse;display:table;}
    thead th{ text-align:left;padding:8px;font-weight:700;background:linear-gradient(90deg,rgba(107,140,255,0.12),rgba(107,140,255,0.04));border-radius:6px;color:#fff;font-size:13px;}
    tbody tr{display:table-row;}
    tbody td{padding:5px 3px;border-bottom:2px solid rgb(255, 255, 255);opacity:0;transform:translateY(8px);transition:opacity .45s ease, transform .45s ease;font-size:14px;vertical-align:middle;}
    tbody td.show{opacity:1;transform:translateY(0);}

    /* Mobile: keep semantics but look like cards */
    @media (max-width:480px){
       .table-wrap{overflow-x:auto}
    table{width:100%;border-collapse:collapse;display:table;}
    thead th{ text-align:left;padding:8px;font-weight:700;background:linear-gradient(90deg,rgba(107,140,255,0.12),rgba(107,140,255,0.04));border-radius:6px;color:#fff;font-size:13px;}
    tbody tr{display:table-row;}
    tbody td{padding:5px 3px;border-bottom:2px solid rgb(255, 255, 255);opacity:0;transform:translateY(8px);transition:opacity .45s ease, transform .45s ease;font-size:14px;vertical-align:middle;}
    tbody td.show{opacity:1;transform:translateY(0);}    
    }

    .note{font-size:12px;color:var(--muted);margin-top:8px;text-align:center}
    .status{font-size:13px;color:var(--muted);margin-bottom:6px}
    /* small image styling so it fits table nicely */
    .cell-image{max-width:60px;max-height:60px;object-fit:contain;border-radius:6px;display:block}

    /* small sheet selector styling (minimal, non-invasive) */
    #sheetSelect{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--text);padding:6px 8px;border-radius:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="region" aria-label="Table slideshow">
      
      <div class="controls" aria-hidden="false" style="display: none;">
        <div class="status" id="status">Loading data…</div>
        <!-- Minimal sheet selector to switch between multiple sheets - non-invasive -->
        <select id="sheetSelect" aria-label="Select sheet">
          <option value="">-- Select sheet --</option>
        </select>
        <button id="loadSheetBtn" class="btn">Load Sheet</button>
        <!-- Kept minimal; user said no more changes — these are optional helpers -->
        <button id="reloadBtn" class="btn">Reload</button>
        <button id="stopBtn" class="btn warn">Stop Anim</button>
      </div>
      <H2 style="text-align: center;">Houston Rockets vs. Atlanta Hawks (Preseason Final: Hawks 115 - Rockets 102)</H2>
      <div class="table-w rap">
        <table aria-live="polite" role="table">
          <thead id="tableHead">
            <tr><th style="width:48px">#</th><th>Name</th><th>Role</th><th style="width:72px">Score</th></tr>
          </thead>
          <tbody id="tableBody">
            <!-- populated dynamically -->
          </tbody>
        </table>
      </div>

    </div>
  </div>

<script>
// ========== CONFIG: paste your deployed Apps Script Web App URL here ==========
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyAEzZ5qVsHEWVjNXNfk7mGKaMaskGtEAr2lMPouJUNi0tdjWvqAoNvHYUOkYgquhY3/exec";
// IMPORTANT: this is the PARAM NAME your Apps Script expects, NOT the sheet value.
// If your Apps Script uses ?sheet=Mobile1 then set this to 'sheet'
const SHEET_PARAM_NAME = 'Mobile2';
// ============================================================================

const ROW_DURATION = 5000;
const COL_DELAY = 300;

const tableBody = document.getElementById('tableBody');
const tableHead = document.getElementById('tableHead');
const statusEl = document.getElementById('status');
const reloadBtn = document.getElementById('reloadBtn');
const stopBtn = document.getElementById('stopBtn');
const sheetSelect = document.getElementById('sheetSelect');
const loadSheetBtn = document.getElementById('loadSheetBtn');

let scheduledTimers = [];
let activeSheet = '';

function clearScheduled(){ scheduledTimers.forEach(t => clearTimeout(t)); scheduledTimers = []; }

// JSONP loader
function loadJSONP(url){
  return new Promise((resolve, reject) => {
    const cbName = 'gs_cb_' + Math.random().toString(36).slice(2);
    window[cbName] = function(data){
      resolve(data);
      try { delete window[cbName]; } catch(e){ window[cbName] = null; }
      const s = document.getElementById(cbName); if (s) s.parentNode.removeChild(s);
    };
    const script = document.createElement('script');
    script.id = cbName;
    script.src = url + (url.indexOf('?') === -1 ? '?' : '&') + 'callback=' + cbName;
    script.onerror = function(){ reject(new Error('JSONP load failed')); try { delete window[cbName]; } catch(e){} if (script.parentNode) script.parentNode.removeChild(script); };
    document.body.appendChild(script);
  });
}

function buildTable(data){
  tableBody.innerHTML = '';
  if (!data || !data.length){
    tableBody.innerHTML = '<tr><td colspan="4">No data</td></tr>';
    return;
  }

  const headers = Object.keys(data[0] || {});
  const thHtml = headers.map((h,i)=>{
    if (i === 0) return '<th style="width:48px">'+escapeHtml(h)+'</th>';
    if (i === headers.length-1) return '<th style="width:72px">'+escapeHtml(h)+'</th>';
    return '<th>'+escapeHtml(h)+'</th>';
  }).join('');
  tableHead.innerHTML = '<tr>' + thHtml + '</tr>';

  function isImageUrl(url){
    if (!url || typeof url !== 'string') return false;
    return !!url.trim().toLowerCase().match(/\.(png|jpe?g|gif|webp|svg)(\?|#|$)/);
  }

  data.forEach((rowObj) => {
    const tr = document.createElement('tr');
    headers.forEach(h => {
      const td = document.createElement('td');
      td.setAttribute('data-label', h);
      const raw = rowObj[h] != null ? String(rowObj[h]) : '';
      if (isImageUrl(raw)) {
        const img = document.createElement('img');
        img.src = raw; img.alt = h; img.className = 'cell-image';
        img.onerror = function(){ td.textContent = raw; };
        td.appendChild(img);
      } else {
        td.textContent = raw;
      }
      tr.appendChild(td);
    });
    tableBody.appendChild(tr);
  });
}

function scheduleAnimations(){
  clearScheduled();
  const rows = Array.from(tableBody.querySelectorAll('tr'));
  rows.forEach((row, rowIndex) => {
    const cells = Array.from(row.querySelectorAll('td'));
    const rowStart = rowIndex * ROW_DURATION;
    cells.forEach((cell, colIndex) => {
      const showTime = rowStart + colIndex * COL_DELAY;
      const t = setTimeout(() => { cell.classList.add('show'); }, showTime);
      scheduledTimers.push(t);
    });
  });
}

function escapeHtml(s){ return String(s).replace(/[&<>"']/g, function(m){ return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]; }); }

// Build URL with sheet param name/value
function buildUrlWithSheet(sheet){
  // if no sheet specified, just return base URL
  if (!sheet) return WEB_APP_URL;
  const sep = WEB_APP_URL.indexOf('?') === -1 ? '?' : '&';
  return WEB_APP_URL + sep + encodeURIComponent(SHEET_PARAM_NAME) + '=' + encodeURIComponent(sheet);
}

// --- MAIN loader with robust response handling ---
async function loadAndRun(sheetName){
  try {
    statusEl.textContent = 'Loading data…';
    clearScheduled();
    tableBody.innerHTML = '';

    const url = buildUrlWithSheet(sheetName || activeSheet);
    const raw = await loadJSONP(url);

    // raw can be:
    // 1) an array -> good
    // 2) an object like { "Mobile1": [ ... ] } -> extract the array
    // 3) an object mapping multiple sheets -> if user requested a specific sheet, try to use that key
    let data = null;
    if (Array.isArray(raw)) {
      data = raw;
    } else if (raw && typeof raw === 'object') {
      // if user requested a specific sheetName, try that key first
      if (sheetName && raw[sheetName] && Array.isArray(raw[sheetName])) {
        data = raw[sheetName];
      } else {
        // try to find the first array-valued property
        const keys = Object.keys(raw);
        for (let k of keys){
          if (Array.isArray(raw[k])) { data = raw[k]; break; }
        }
        // if object contains nested single-key like { "Mobile1": {...} } and that inner is object with "error" etc, try more
        if (!data && keys.length === 1 && Array.isArray(raw[keys[0]])) {
          data = raw[keys[0]];
        }
      }
    }

    if (!data || !data.length){
      statusEl.textContent = 'No data';
      tableBody.innerHTML = '<tr><td colspan="4">No data (server returned empty or unexpected format).</td></tr>';
      console.warn('Raw server response:', raw);
      return;
    }

    buildTable(data);
    statusEl.textContent = 'Animating…';
    scheduleAnimations();

  } catch (err){
    console.error(err);
    statusEl.textContent = 'Load error';
    tableBody.innerHTML = '<tr><td colspan="4">Error loading data. Check Apps Script URL, sheet name, and deploy settings.</td></tr>';
  }
}

// try to load sheet list (if server supports listSheets=true)
async function tryLoadSheetList(){
  try{
    const sep = WEB_APP_URL.indexOf('?') === -1 ? '?' : '&';
    const listUrl = WEB_APP_URL + sep + 'listSheets=true';
    const sheets = await loadJSONP(listUrl);
    if (Array.isArray(sheets) && sheets.length){
      sheets.forEach(s => {
        const opt = document.createElement('option');
        opt.value = s; opt.textContent = s; sheetSelect.appendChild(opt);
      });
    }
  }catch(e){ console.warn('Sheet list not available from Apps Script'); }
}

// controls
reloadBtn.addEventListener('click', () => { clearScheduled(); loadAndRun(); });
stopBtn.addEventListener('click', () => { clearScheduled(); statusEl.textContent = 'Animation stopped'; });

loadSheetBtn.addEventListener('click', async () => {
  const val = sheetSelect.value;
  if (!val){
    const promptName = window.prompt('Enter sheet name exactly as in Google Sheets:');
    if (promptName) {
      activeSheet = promptName.trim();
      const opt = document.createElement('option'); opt.value = activeSheet; opt.textContent = activeSheet; sheetSelect.appendChild(opt); sheetSelect.value = activeSheet;
      await loadAndRun(activeSheet);
    }
  } else {
    activeSheet = val;
    await loadAndRun(activeSheet);
  }
});

// init
if (WEB_APP_URL.indexOf('REPLACE_WITH_YOURS') !== -1){
  statusEl.textContent = 'Replace WEB_APP_URL in the HTML with your Apps Script URL and reload.';
  tableBody.innerHTML = '<tr><td colspan="4">Replace WEB_APP_URL placeholder with your deployed Apps Script Web App URL.</td></tr>';
} else {
  tryLoadSheetList();
  loadAndRun();
}
</script>

</body>
</html>
